console.log("Global Nav Loaded ... ")
var $ = layui.jquery, layer = layui.layer, darkStyleUrl = "../modules/global-style/layui-theme-dark.css";

const now = new Date().getHours();
const startDarkModeAt = 7;
const endDarkModeAt = 20;

function checkRadio(name) {
    var radios = document.getElementsByName(name);
    var result = '';

    for (var i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            result = radios[i].value;
        }
    }

    return result;
}

function loadCSS(href) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = href;
    document.head.appendChild(link);
}

function removeCSS(href) {
    var links = document.getElementsByTagName('link');
    for (var i = 0; i < links.length; i++) {
        if (links[i].getAttribute('rel') === 'stylesheet' && links[i].getAttribute('href') === href) {
            document.head.removeChild(links[i]);
            break;
        }
    }
}

function autoDarkMode() {
    if (now >= endDarkModeAt || now <= startDarkModeAt) {
        loadCSS(darkStyleUrl);
        document.getElementById("darkmode_dark").checked = true;
        console.log(`${now}h now. Auto Dark mode ON.`);
    } else {
        removeCSS(darkStyleUrl);
        document.getElementById("darkmode_white").checked = true;
        console.log(`${now}h now. Auto Dark mode OFF.`);
    }
}

function kqyContact() {
    layer.open({
        type: 1,
        title: false,
        closeBtn: 0,
        area: '1000px',
        skin: 'layui-layer-nobg', //没有背景色
        shadeClose: true,
        content: '<img src="../modules/image/contact.png" alt="联系我" style="height:400px;width:auto;">'
    });
}

function setSettings() {
    layer.open({
        title: '设置',
        shade: 0.6, // 遮罩透明度
        shadeClose: true, // 点击遮罩区域，关闭弹层
        anim: 0, // 0-6 的动画形式，-1 不开启
        type: 1,
        skin: 'layui-layer-rim',
        area: ['470px', '160px'],
        content: $('#pageSettings'),
        maxmin: true,
        minStack: false, //最小化不堆叠在左下角
        id: 'pageSettings', //定义 ID，防止重复弹出
        min: function (layero, index) {
            layer.msg('阻止了默认的最小化');
            layer.style(index, {
                top: 'auto',
                bottom: 0
            });
            return false;
        },
        end: function () {
            $("#pageSettings").hide();
        }
    });
}

function chooseDarkRadio() {
    const dark = checkRadio("darkmode");

    if (dark == "dark") {
        loadCSS(darkStyleUrl);
        document.documentElement.classList.add('dark');
        // Cookies.set("sss_darkmode", "true", { expires: 31 });
    } else if (dark == "white") {
        document.documentElement.classList.remove('dark');
        try { removeCSS(darkStyleUrl) } catch { }
        // Cookies.set("sss_darkmode", "false", { expires: 31 });
    } else if (dark == "any") {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            loadCSS(darkStyleUrl);
        } else {
            try { removeCSS(darkStyleUrl) } catch { }
        }
        // Cookies.set("sss_darkmode", "any", { expires: 31 });
    }
}